<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>TG-ADMIN Dashboard</title>
    <script src="config.js"></script>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 250px;
            height: 100vh;
            background: linear-gradient(180deg, #1e3a5f 0%, #16213e 100%);
            color: white;
            padding: 20px 0;
            z-index: 100;
        }
        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            margin-bottom: 20px;
        }
        .sidebar-header h1 {
            font-size: 1.3rem;
            color: #e94560;
        }
        .sidebar-header .store-name {
            font-size: 0.9rem;
            color: #94a3b8;
            margin-top: 5px;
        }
        .nav-menu {
            list-style: none;
        }
        .nav-menu li a {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 20px;
            color: #94a3b8;
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        .nav-menu li a:hover,
        .nav-menu li a.active {
            background: rgba(255,255,255,0.05);
            color: white;
            border-left-color: #e94560;
        }
        .nav-menu li a .icon {
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        /* Main Content */
        .main-content {
            margin-left: 250px;
            padding: 20px 30px;
        }

        /* Top Bar */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }
        .page-title {
            font-size: 1.6rem;
            color: #1e3a5f;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .user-info .avatar {
            width: 40px;
            height: 40px;
            background: #e94560;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Dashboard Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        .stat-card .label {
            color: #64748b;
            font-size: 0.9rem;
            margin-bottom: 8px;
        }
        .stat-card .value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #1e3a5f;
        }
        .stat-card .change {
            font-size: 0.85rem;
            margin-top: 5px;
        }
        .stat-card .change.up { color: #22c55e; }
        .stat-card .change.down { color: #ef4444; }

        /* Cards */
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            margin-bottom: 20px;
        }
        .card-header {
            padding: 15px 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .card-header h3 {
            font-size: 1.1rem;
            color: #1e3a5f;
        }
        .card-body {
            padding: 20px;
        }

        /* Tables */
        .data-table {
            width: 100%;
            border-collapse: collapse;
        }
        .data-table th,
        .data-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }
        .data-table th {
            background: #f8fafc;
            font-weight: 600;
            color: #64748b;
            font-size: 0.85rem;
        }
        .data-table tbody tr:hover {
            background: #f8fafc;
        }

        /* Buttons */
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }
        .btn-primary {
            background: #e94560;
            color: white;
        }
        .btn-primary:hover {
            background: #d63d56;
        }
        .btn-secondary {
            background: #e2e8f0;
            color: #475569;
        }
        .btn-sm {
            padding: 5px 10px;
            font-size: 0.8rem;
        }

        /* Badge */
        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .badge-success { background: #dcfce7; color: #166534; }
        .badge-warning { background: #fef3c7; color: #92400e; }
        .badge-danger { background: #fee2e2; color: #991b1b; }
        .badge-info { background: #dbeafe; color: #1e40af; }

        /* Grid Layout */
        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        /* Section Visibility */
        .section { display: none; }
        .section.active { display: block; }

        /* Form */
        .form-group {
            margin-bottom: 15px;
        }
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #475569;
        }
        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 0.95rem;
        }
        .form-control:focus {
            outline: none;
            border-color: #e94560;
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 200;
            align-items: center;
            justify-content: center;
        }
        .modal-overlay.active {
            display: flex;
        }
        .modal {
            background: white;
            border-radius: 12px;
            width: 500px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-header {
            padding: 15px 20px;
            border-bottom: 1px solid #e2e8f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .modal-body {
            padding: 20px;
        }
        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }
        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
        }

        /* Product List */
        .product-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
        }
        .product-item:last-child { border-bottom: none; }
        .product-img {
            width: 50px;
            height: 50px;
            background: #f1f5f9;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }
        .product-info {
            flex: 1;
        }
        .product-info .name {
            font-weight: 500;
            color: #1e3a5f;
        }
        .product-info .price {
            color: #64748b;
            font-size: 0.9rem;
        }
        .product-actions {
            display: flex;
            gap: 8px;
        }

        /* Inventory Alert */
        .alert-row {
            background: #fef2f2;
        }

        /* Chart Placeholder */
        .chart-placeholder {
            height: 250px;
            background: #f8fafc;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #94a3b8;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <h1>TG-ADMIN</h1>
            <div class="store-name" id="storeName">Loading...</div>
        </div>
        <ul class="nav-menu">
            <li><a href="#" class="active" data-section="dashboard"><span class="icon">ğŸ“Š</span> ëŒ€ì‹œë³´ë“œ</a></li>
            <li><a href="#" data-section="products"><span class="icon">ğŸ”</span> ìƒí’ˆ ê´€ë¦¬</a></li>
            <li><a href="#" data-section="inventory"><span class="icon">ğŸ“¦</span> ì¬ê³  ê´€ë¦¬</a></li>
            <li><a href="#" data-section="orders"><span class="icon">ğŸ§¾</span> ì£¼ë¬¸ ë‚´ì—­</a></li>
            <li><a href="#" data-section="members"><span class="icon">ğŸ‘¥</span> íšŒì› ê´€ë¦¬</a></li>
            <li><a href="#" data-section="staff"><span class="icon">ğŸ‘¤</span> ì§ì› ê´€ë¦¬</a></li>
            <li><a href="#" data-section="settings"><span class="icon">âš™ï¸</span> ë§¤ì¥ ì„¤ì •</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="top-bar">
            <h2 class="page-title" id="pageTitle">ëŒ€ì‹œë³´ë“œ</h2>
            <div class="user-info">
                <span id="userName">ê´€ë¦¬ì</span>
                <div class="avatar" id="userAvatar">A</div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div class="section active" id="section-dashboard">
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="label">ì˜¤ëŠ˜ ë§¤ì¶œ</div>
                    <div class="value" id="todaySales">â‚©0</div>
                    <div class="change up" id="salesChange">+0%</div>
                </div>
                <div class="stat-card">
                    <div class="label">ì˜¤ëŠ˜ ì£¼ë¬¸</div>
                    <div class="value" id="todayOrders">0ê±´</div>
                    <div class="change up" id="ordersChange">+0%</div>
                </div>
                <div class="stat-card">
                    <div class="label">ì‹ ê·œ íšŒì›</div>
                    <div class="value" id="newMembers">0ëª…</div>
                    <div class="change" id="membersChange">-</div>
                </div>
                <div class="stat-card">
                    <div class="label">ì¬ê³  ë¶€ì¡±</div>
                    <div class="value" id="lowStockCount" style="color: #ef4444;">0ê°œ</div>
                    <div class="change">ì¦‰ì‹œ í™•ì¸ í•„ìš”</div>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <div class="card-header">
                        <h3>ì‹œê°„ëŒ€ë³„ ë§¤ì¶œ</h3>
                    </div>
                    <div class="card-body">
                        <div class="chart-placeholder" id="hourlyChart">
                            ì°¨íŠ¸ ë¡œë”©ì¤‘...
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <h3>ì¸ê¸° ìƒí’ˆ TOP 5</h3>
                    </div>
                    <div class="card-body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ìˆœìœ„</th>
                                    <th>ìƒí’ˆëª…</th>
                                    <th>íŒë§¤ëŸ‰</th>
                                    <th>ë§¤ì¶œ</th>
                                </tr>
                            </thead>
                            <tbody id="topProducts">
                                <tr><td colspan="4" class="loading">ë¡œë”©ì¤‘...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h3>ìµœê·¼ ì£¼ë¬¸</h3>
                    <a href="#" data-section="orders" class="btn btn-secondary btn-sm">ì „ì²´ë³´ê¸°</a>
                </div>
                <div class="card-body">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ì£¼ë¬¸ë²ˆí˜¸</th>
                                <th>í…Œì´ë¸”</th>
                                <th>ê¸ˆì•¡</th>
                                <th>ê²°ì œìˆ˜ë‹¨</th>
                                <th>ìƒíƒœ</th>
                                <th>ì‹œê°„</th>
                            </tr>
                        </thead>
                        <tbody id="recentOrders">
                            <tr><td colspan="6" class="loading">ë¡œë”©ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Products Section -->
        <div class="section" id="section-products">
            <div class="card">
                <div class="card-header">
                    <h3>ìƒí’ˆ ëª©ë¡</h3>
                    <button class="btn btn-primary" onclick="openProductModal()">+ ìƒí’ˆ ì¶”ê°€</button>
                </div>
                <div class="card-body">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ìƒí’ˆëª…</th>
                                <th>ì¹´í…Œê³ ë¦¬</th>
                                <th>ê°€ê²©</th>
                                <th>ìƒíƒœ</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="productList">
                            <tr><td colspan="5" class="loading">ë¡œë”©ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Inventory Section -->
        <div class="section" id="section-inventory">
            <div class="card">
                <div class="card-header">
                    <h3>ì¬ê³  í˜„í™©</h3>
                    <button class="btn btn-primary" onclick="openInventoryModal()">+ ì…ê³  ë“±ë¡</button>
                </div>
                <div class="card-body">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>í’ˆëª©ëª…</th>
                                <th>í˜„ì¬ ìˆ˜ëŸ‰</th>
                                <th>ì•ˆì „ ì¬ê³ </th>
                                <th>ë‹¨ìœ„</th>
                                <th>ìƒíƒœ</th>
                                <th>ìµœì¢… ìˆ˜ì •</th>
                            </tr>
                        </thead>
                        <tbody id="inventoryList">
                            <tr><td colspan="6" class="loading">ë¡œë”©ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Orders Section -->
        <div class="section" id="section-orders">
            <div class="card">
                <div class="card-header">
                    <h3>ì£¼ë¬¸ ë‚´ì—­</h3>
                    <div>
                        <input type="date" id="orderDateFilter" class="form-control" style="width: auto; display: inline-block;">
                        <button class="btn btn-secondary" onclick="loadOrders()">ê²€ìƒ‰</button>
                    </div>
                </div>
                <div class="card-body">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ì£¼ë¬¸ë²ˆí˜¸</th>
                                <th>í…Œì´ë¸”</th>
                                <th>ìƒí’ˆ</th>
                                <th>ê¸ˆì•¡</th>
                                <th>ê²°ì œ</th>
                                <th>ìƒíƒœ</th>
                                <th>ì¼ì‹œ</th>
                            </tr>
                        </thead>
                        <tbody id="orderList">
                            <tr><td colspan="7" class="loading">ë¡œë”©ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Members Section -->
        <div class="section" id="section-members">
            <div class="card">
                <div class="card-header">
                    <h3>íšŒì› ëª©ë¡</h3>
                </div>
                <div class="card-body">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>íšŒì›ë²ˆí˜¸</th>
                                <th>ì „í™”ë²ˆí˜¸</th>
                                <th>í¬ì¸íŠ¸</th>
                                <th>ëˆ„ì  ì ë¦½</th>
                                <th>ìµœê·¼ ë°©ë¬¸</th>
                            </tr>
                        </thead>
                        <tbody id="memberList">
                            <tr><td colspan="5" class="loading">ë¡œë”©ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Staff Section -->
        <div class="section" id="section-staff">
            <div class="card">
                <div class="card-header">
                    <h3>ì§ì› ëª©ë¡</h3>
                    <button class="btn btn-primary" onclick="openStaffModal()">+ ì§ì› ì¶”ê°€</button>
                </div>
                <div class="card-body">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ì´ë¦„</th>
                                <th>ì•„ì´ë””</th>
                                <th>ê¶Œí•œ</th>
                                <th>ìƒíƒœ</th>
                                <th>ê´€ë¦¬</th>
                            </tr>
                        </thead>
                        <tbody id="staffList">
                            <tr><td colspan="5" class="loading">ë¡œë”©ì¤‘...</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Settings Section -->
        <div class="section" id="section-settings">
            <div class="card">
                <div class="card-header">
                    <h3>ë§¤ì¥ ì„¤ì •</h3>
                </div>
                <div class="card-body">
                    <form id="storeSettingsForm">
                        <div class="form-group">
                            <label>ë§¤ì¥ëª…</label>
                            <input type="text" class="form-control" id="settingStoreName">
                        </div>
                        <div class="form-group">
                            <label>ì£¼ì†Œ</label>
                            <input type="text" class="form-control" id="settingAddress">
                        </div>
                        <div class="form-group">
                            <label>ì „í™”ë²ˆí˜¸</label>
                            <input type="text" class="form-control" id="settingPhone">
                        </div>
                        <div class="form-group">
                            <label>ì˜ì—… ì‹œì‘ ì‹œê°„</label>
                            <input type="time" class="form-control" id="settingOpenTime">
                        </div>
                        <div class="form-group">
                            <label>ì˜ì—… ì¢…ë£Œ ì‹œê°„</label>
                            <input type="time" class="form-control" id="settingCloseTime">
                        </div>
                        <button type="submit" class="btn btn-primary">ì €ì¥</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Product Modal -->
    <div class="modal-overlay" id="productModal">
        <div class="modal">
            <div class="modal-header">
                <h3 id="productModalTitle">ìƒí’ˆ ì¶”ê°€</h3>
                <button class="close-btn" onclick="closeProductModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="productForm">
                    <input type="hidden" id="productId">
                    <div class="form-group">
                        <label>ìƒí’ˆëª…</label>
                        <input type="text" class="form-control" id="productName" required>
                    </div>
                    <div class="form-group">
                        <label>ì¹´í…Œê³ ë¦¬</label>
                        <select class="form-control" id="productCategory"></select>
                    </div>
                    <div class="form-group">
                        <label>ê°€ê²©</label>
                        <input type="number" class="form-control" id="productPrice" required>
                    </div>
                    <div class="form-group">
                        <label>ì„¤ëª…</label>
                        <textarea class="form-control" id="productDesc" rows="3"></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeProductModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="saveProduct()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <!-- Inventory Modal -->
    <div class="modal-overlay" id="inventoryModal">
        <div class="modal">
            <div class="modal-header">
                <h3>ì…ê³  ë“±ë¡</h3>
                <button class="close-btn" onclick="closeInventoryModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="inventoryForm">
                    <div class="form-group">
                        <label>í’ˆëª©ëª…</label>
                        <input type="text" class="form-control" id="invItemName" required>
                    </div>
                    <div class="form-group">
                        <label>ìˆ˜ëŸ‰ ë³€í™” (+ì…ê³  / -ì‚¬ìš©)</label>
                        <input type="number" class="form-control" id="invChangeQty" required>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeInventoryModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="saveInventory()">ì €ì¥</button>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = CONFIG.API_BASE;
        let STORE_ID = 1;
        let currentUser = null;

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Check auth
            const token = localStorage.getItem('token');
            const storeId = localStorage.getItem('store_id');
            const storeName = localStorage.getItem('store_name');
            const userName = localStorage.getItem('user_name');

            if (storeId) STORE_ID = parseInt(storeId);
            if (storeName) document.getElementById('storeName').textContent = storeName;
            if (userName) {
                document.getElementById('userName').textContent = userName;
                document.getElementById('userAvatar').textContent = userName.charAt(0).toUpperCase();
            }

            // Set today's date for order filter
            document.getElementById('orderDateFilter').value = new Date().toISOString().split('T')[0];

            // Load dashboard data
            loadDashboard();

            // Navigation
            document.querySelectorAll('.nav-menu a').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = e.target.closest('a').dataset.section;
                    showSection(section);
                });
            });
        });

        // Show section
        function showSection(sectionName) {
            // Update nav
            document.querySelectorAll('.nav-menu a').forEach(a => a.classList.remove('active'));
            document.querySelector(`.nav-menu a[data-section="${sectionName}"]`).classList.add('active');

            // Update title
            const titles = {
                'dashboard': 'ëŒ€ì‹œë³´ë“œ',
                'products': 'ìƒí’ˆ ê´€ë¦¬',
                'inventory': 'ì¬ê³  ê´€ë¦¬',
                'orders': 'ì£¼ë¬¸ ë‚´ì—­',
                'members': 'íšŒì› ê´€ë¦¬',
                'staff': 'ì§ì› ê´€ë¦¬',
                'settings': 'ë§¤ì¥ ì„¤ì •'
            };
            document.getElementById('pageTitle').textContent = titles[sectionName] || sectionName;

            // Show section
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(`section-${sectionName}`).classList.add('active');

            // Load data
            switch(sectionName) {
                case 'dashboard': loadDashboard(); break;
                case 'products': loadProducts(); break;
                case 'inventory': loadInventory(); break;
                case 'orders': loadOrders(); break;
                case 'members': loadMembers(); break;
                case 'staff': loadStaff(); break;
                case 'settings': loadSettings(); break;
            }
        }

        // Format currency
        function formatCurrency(amount) {
            return 'â‚©' + (amount || 0).toLocaleString();
        }

        // Get status badge
        function getStatusBadge(status) {
            const badges = {
                'paid': '<span class="badge badge-info">ê²°ì œì™„ë£Œ</span>',
                'preparing': '<span class="badge badge-warning">ì¡°ë¦¬ì¤‘</span>',
                'ready': '<span class="badge badge-success">ì™„ë£Œ</span>',
                'completed': '<span class="badge badge-success">ì™„ë£Œ</span>',
                'canceled': '<span class="badge badge-danger">ì·¨ì†Œ</span>',
                'pending': '<span class="badge badge-warning">ëŒ€ê¸°</span>'
            };
            return badges[status] || status;
        }

        // Load Dashboard
        async function loadDashboard() {
            try {
                const today = new Date().toISOString().split('T')[0];

                // Load stats in parallel
                const [statsRes, rankRes, ordersRes, inventoryRes] = await Promise.all([
                    fetch(`${API_BASE}/stats/range?store_id=${STORE_ID}&start_date=${today}&end_date=${today}`),
                    fetch(`${API_BASE}/stats/products/rank?store_id=${STORE_ID}&limit=5`),
                    fetch(`${API_BASE}/orders/history/${STORE_ID}?limit=5`),
                    fetch(`${API_BASE}/inventory/list/${STORE_ID}`)
                ]);

                const stats = await statsRes.json();
                const rank = await rankRes.json();
                const orders = await ordersRes.json();
                const inventory = await inventoryRes.json();

                // Update stats
                document.getElementById('todaySales').textContent = formatCurrency(stats.total_revenue);
                document.getElementById('todayOrders').textContent = (stats.order_count || 0) + 'ê±´';

                // Low stock count
                const lowStock = inventory.filter(i => i.low_stock);
                document.getElementById('lowStockCount').textContent = lowStock.length + 'ê°œ';

                // Top products
                const topProducts = document.getElementById('topProducts');
                if (rank.length === 0) {
                    topProducts.innerHTML = '<tr><td colspan="4" style="text-align:center;color:#94a3b8;">ë°ì´í„° ì—†ìŒ</td></tr>';
                } else {
                    topProducts.innerHTML = rank.map((p, i) => `
                        <tr>
                            <td>${i + 1}</td>
                            <td>${p.product_name}</td>
                            <td>${p.total_quantity}ê°œ</td>
                            <td>${formatCurrency(p.total_revenue)}</td>
                        </tr>
                    `).join('');
                }

                // Recent orders
                const recentOrders = document.getElementById('recentOrders');
                if (orders.orders.length === 0) {
                    recentOrders.innerHTML = '<tr><td colspan="6" style="text-align:center;color:#94a3b8;">ë°ì´í„° ì—†ìŒ</td></tr>';
                } else {
                    recentOrders.innerHTML = orders.orders.map(o => `
                        <tr>
                            <td>#${o.id.substring(0, 8)}</td>
                            <td>${o.table || '-'}</td>
                            <td>${formatCurrency(o.total)}</td>
                            <td>${o.payment_method || '-'}</td>
                            <td>${getStatusBadge(o.status)}</td>
                            <td>${new Date(o.created_at).toLocaleTimeString('ko-KR', {hour: '2-digit', minute: '2-digit'})}</td>
                        </tr>
                    `).join('');
                }

                // Simple hourly chart (text-based)
                const hourlyRes = await fetch(`${API_BASE}/stats/hourly?store_id=${STORE_ID}&date=${today}`);
                const hourly = await hourlyRes.json();
                const chartDiv = document.getElementById('hourlyChart');

                if (hourly.length === 0) {
                    chartDiv.textContent = 'ì˜¤ëŠ˜ ë°ì´í„° ì—†ìŒ';
                } else {
                    const maxRevenue = Math.max(...hourly.map(h => h.revenue));
                    chartDiv.innerHTML = `
                        <div style="width:100%;height:100%;display:flex;align-items:flex-end;justify-content:space-around;padding:10px;">
                            ${hourly.map(h => {
                                const height = maxRevenue > 0 ? (h.revenue / maxRevenue * 180) : 0;
                                return `
                                    <div style="text-align:center;">
                                        <div style="background:#e94560;width:30px;height:${height}px;border-radius:4px 4px 0 0;margin-bottom:5px;"></div>
                                        <div style="font-size:0.7rem;color:#64748b;">${h.hour}ì‹œ</div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    `;
                }

            } catch(e) {
                console.error('Dashboard error:', e);
            }
        }

        // Load Products
        async function loadProducts() {
            try {
                const [productsRes, categoriesRes] = await Promise.all([
                    fetch(`${API_BASE}/products/list/${STORE_ID}?include_soldout=true`),
                    fetch(`${API_BASE}/products/categories/${STORE_ID}`)
                ]);
                const products = await productsRes.json();
                const categories = await categoriesRes.json();

                // Populate category select
                const catSelect = document.getElementById('productCategory');
                catSelect.innerHTML = categories.map(c =>
                    `<option value="${c.id}">${c.name}</option>`
                ).join('');

                const tbody = document.getElementById('productList');
                if (products.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#94a3b8;">ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                } else {
                    tbody.innerHTML = products.map(p => `
                        <tr>
                            <td>${p.name}</td>
                            <td>${categories.find(c => c.id === p.category_id)?.name || '-'}</td>
                            <td>${formatCurrency(p.price)}</td>
                            <td>${p.is_soldout ? '<span class="badge badge-danger">í’ˆì ˆ</span>' : '<span class="badge badge-success">íŒë§¤ì¤‘</span>'}</td>
                            <td>
                                <button class="btn btn-secondary btn-sm" onclick="editProduct(${p.id})">ìˆ˜ì •</button>
                                <button class="btn btn-secondary btn-sm" onclick="toggleSoldout(${p.id}, ${!p.is_soldout})">${p.is_soldout ? 'íŒë§¤ì¬ê°œ' : 'í’ˆì ˆì²˜ë¦¬'}</button>
                            </td>
                        </tr>
                    `).join('');
                }
            } catch(e) {
                console.error('Products error:', e);
            }
        }

        // Load Inventory
        async function loadInventory() {
            try {
                const res = await fetch(`${API_BASE}/inventory/list/${STORE_ID}`);
                const items = await res.json();

                const tbody = document.getElementById('inventoryList');
                if (items.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align:center;color:#94a3b8;">ë“±ë¡ëœ ì¬ê³ ê°€ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                } else {
                    tbody.innerHTML = items.map(i => `
                        <tr class="${i.low_stock ? 'alert-row' : ''}">
                            <td>${i.item_name}</td>
                            <td>${i.current_qty}</td>
                            <td>${i.safety_stock}</td>
                            <td>${i.unit}</td>
                            <td>${i.low_stock ? '<span class="badge badge-danger">ë¶€ì¡±</span>' : '<span class="badge badge-success">ì •ìƒ</span>'}</td>
                            <td>${i.last_updated || '-'}</td>
                        </tr>
                    `).join('');
                }
            } catch(e) {
                console.error('Inventory error:', e);
            }
        }

        // Load Orders
        async function loadOrders() {
            try {
                const date = document.getElementById('orderDateFilter').value;
                const res = await fetch(`${API_BASE}/orders/history/${STORE_ID}?date=${date}&limit=100`);
                const data = await res.json();

                const tbody = document.getElementById('orderList');
                if (data.orders.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align:center;color:#94a3b8;">ì£¼ë¬¸ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                } else {
                    tbody.innerHTML = data.orders.map(o => `
                        <tr>
                            <td>#${o.id.substring(0, 8)}</td>
                            <td>${o.table || '-'}</td>
                            <td>${o.items.map(i => i.name).join(', ')}</td>
                            <td>${formatCurrency(o.total)}</td>
                            <td>${o.payment_method || '-'}</td>
                            <td>${getStatusBadge(o.status)}</td>
                            <td>${new Date(o.created_at).toLocaleString('ko-KR')}</td>
                        </tr>
                    `).join('');
                }
            } catch(e) {
                console.error('Orders error:', e);
            }
        }

        // Load Members
        async function loadMembers() {
            try {
                const res = await fetch(`${API_BASE}/membership/list/${STORE_ID}`);
                const members = await res.json();

                const tbody = document.getElementById('memberList');
                if (!members || members.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#94a3b8;">ë“±ë¡ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                } else {
                    tbody.innerHTML = members.map(m => `
                        <tr>
                            <td>${m.id}</td>
                            <td>${m.phone}</td>
                            <td>${m.current_points?.toLocaleString() || 0}P</td>
                            <td>${m.total_accumulated?.toLocaleString() || 0}P</td>
                            <td>${m.last_visit || '-'}</td>
                        </tr>
                    `).join('');
                }
            } catch(e) {
                console.error('Members error:', e);
                document.getElementById('memberList').innerHTML = '<tr><td colspan="5" style="text-align:center;color:#94a3b8;">íšŒì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</td></tr>';
            }
        }

        // Load Staff
        async function loadStaff() {
            try {
                const res = await fetch(`${API_BASE}/hr/employees/${STORE_ID}`);
                const staff = await res.json();

                const tbody = document.getElementById('staffList');
                if (!staff || staff.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="5" style="text-align:center;color:#94a3b8;">ë“±ë¡ëœ ì§ì›ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>';
                } else {
                    tbody.innerHTML = staff.map(s => `
                        <tr>
                            <td>${s.name}</td>
                            <td>${s.username || '-'}</td>
                            <td>${s.role || '-'}</td>
                            <td><span class="badge badge-success">í™œì„±</span></td>
                            <td>
                                <button class="btn btn-secondary btn-sm">ìˆ˜ì •</button>
                            </td>
                        </tr>
                    `).join('');
                }
            } catch(e) {
                console.error('Staff error:', e);
                document.getElementById('staffList').innerHTML = '<tr><td colspan="5" style="text-align:center;color:#94a3b8;">ì§ì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</td></tr>';
            }
        }

        // Load Settings
        async function loadSettings() {
            try {
                const res = await fetch(`${API_BASE}/store/config/${STORE_ID}`);
                const config = await res.json();

                document.getElementById('settingStoreName').value = config.store_name || '';
                document.getElementById('settingAddress').value = config.address || '';
                document.getElementById('settingPhone').value = config.phone || '';
                document.getElementById('settingOpenTime').value = config.open_time || '09:00';
                document.getElementById('settingCloseTime').value = config.close_time || '22:00';
            } catch(e) {
                console.error('Settings error:', e);
            }
        }

        // Product Modal
        function openProductModal(product = null) {
            document.getElementById('productModal').classList.add('active');
            document.getElementById('productModalTitle').textContent = product ? 'ìƒí’ˆ ìˆ˜ì •' : 'ìƒí’ˆ ì¶”ê°€';
            document.getElementById('productForm').reset();
            if (product) {
                document.getElementById('productId').value = product.id;
                document.getElementById('productName').value = product.name;
                document.getElementById('productCategory').value = product.category_id;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productDesc').value = product.description || '';
            }
        }

        function closeProductModal() {
            document.getElementById('productModal').classList.remove('active');
        }

        async function saveProduct() {
            const id = document.getElementById('productId').value;
            const data = {
                store_id: STORE_ID,
                name: document.getElementById('productName').value,
                category_id: parseInt(document.getElementById('productCategory').value),
                price: parseInt(document.getElementById('productPrice').value),
                description: document.getElementById('productDesc').value
            };

            try {
                const url = id ? `${API_BASE}/products/${id}` : `${API_BASE}/products/`;
                const method = id ? 'PUT' : 'POST';
                await fetch(url, {
                    method,
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                closeProductModal();
                loadProducts();
            } catch(e) {
                alert('ì €ì¥ ì‹¤íŒ¨');
            }
        }

        async function editProduct(id) {
            try {
                const res = await fetch(`${API_BASE}/products/${id}`);
                const product = await res.json();
                openProductModal(product);
            } catch(e) {
                alert('ìƒí’ˆ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤');
            }
        }

        async function toggleSoldout(id, soldout) {
            try {
                await fetch(`${API_BASE}/products/${id}/soldout`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ is_soldout: soldout })
                });
                loadProducts();
            } catch(e) {
                alert('ìƒíƒœ ë³€ê²½ ì‹¤íŒ¨');
            }
        }

        // Inventory Modal
        function openInventoryModal() {
            document.getElementById('inventoryModal').classList.add('active');
            document.getElementById('inventoryForm').reset();
        }

        function closeInventoryModal() {
            document.getElementById('inventoryModal').classList.remove('active');
        }

        async function saveInventory() {
            const data = {
                store_id: STORE_ID,
                item_name: document.getElementById('invItemName').value,
                change_qty: parseFloat(document.getElementById('invChangeQty').value)
            };

            try {
                await fetch(`${API_BASE}/inventory/update`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                closeInventoryModal();
                loadInventory();
            } catch(e) {
                alert('ì €ì¥ ì‹¤íŒ¨');
            }
        }

        // Settings form
        document.getElementById('storeSettingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            try {
                await fetch(`${API_BASE}/store/config/${STORE_ID}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        store_name: document.getElementById('settingStoreName').value,
                        address: document.getElementById('settingAddress').value,
                        phone: document.getElementById('settingPhone').value,
                        open_time: document.getElementById('settingOpenTime').value,
                        close_time: document.getElementById('settingCloseTime').value
                    })
                });
                alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤');
            } catch(e) {
                alert('ì €ì¥ ì‹¤íŒ¨');
            }
        });
    </script>
</body>
</html>
